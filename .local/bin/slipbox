#!/usr/bin/env bash

DIR="$HOME/.local/share/slipbox"
TERM='/usr/bin/x-terminal-emulator'
EDITOR='/usr/bin/nvim'

[[ -d "$DIR" ]] && mkdir -p "$DIR"

function add_note () {
	parent=$(find "$DIR" -type d | sed 's/^\/home\/.*\/.local\/share\/slipbox//g;/^$/d' | rofi -dmenu -matching fuzzy -p 'Parent note ');
	name=$(rofi -dmenu -matching fuzzy -p 'Note name ' | tr ' ' '-');
	[[ ! -z "$name" ]] && $TERM -e $EDITOR "$DIR/$parent/$name.md";
}

function edit_note () {
	list=$(find "$DIR" -type f -name '*.md' | sed 's/\.md$//g;/^$/d;s/^\/home\/.*\/.local\/share\/slipbox\///g');
	name=$(echo "$list" | rofi -dmenu -matching fuzzy -p 'Note to edit ' | tr ' ' '-');
	[[ ! -z "$name" ]] && $TERM -e $EDITOR "$DIR/$name.md";
}

case "$1" in
	add)
		add_note
		;;
	edit)
		edit_note
		;;
	*)
		exit
		;;
esac
